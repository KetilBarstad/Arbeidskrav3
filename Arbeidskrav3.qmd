openpowerlifting \<- read.csv("C:/Users/ketil/Downloads/openpowerlifting.csv")

---
title: "Arbeidskrav 3: Statistisk analyse av Openpowerlifting datasettet"
author: Ketil B., Laurits H., Herman E. og Theodor S.
date: 21/10/25
format:
  html:
    toc: true
    toc-location: right
    toc-title: "Innhold"
    toc-depth: 4
    number-sections: true
---

# Beskrive sammenhenger

Første del av arbeidskravet tar utgangspunkt i "Openpowerlifting" datasettet.

Begreper som brukes videre i denne analysen:

**Total***: Summen av beste løftet i knebøy, benkpress og markløft sammenlagt, uttrykt i antall kilogram (eksempel: 150kg knebøy, 100 kg benkpress, 200 kg markløft = total på 450 kg)*

**Maksimalstyrke**: Brukes synonymt med total i denne analysen

**Utstyrsfritt**: Det innebærer at man kun kan bruke et enkelt lag løftebelte (10 - 13mm bredde), myke knevarmere, håndleddsstøtter og drakt uten støtte. Alt annet utstyr er ikke tillatt.

## Sammenhengen mellom to kontinuerlige variabler (Total og krosppvekt)

```{r}
#| include: false
#Last inn nødvendige pakker
library(tidyverse)
library(readxl)
library(broom)
library(knitr)

#Last inn datasettet. Skriv inn ditt egen navn og lokasjon
#filen i stedet for "Ketil" og "Downloads"
openpowerlifting <- read.csv("C:/Users/laurits/Desktop/openpowerlifting.csv")




```

```{r}

powerlifting.clean <- openpowerlifting |>
  filter(
    !is.na(TotalKg),  #Har en registrert total
    TotalKg > 0,
    Equipment == "Raw", #Utstyrsfritt
    !is.na(Tested), #Dopingtestet
    Sex %in% c("M", "F"), #Kun kvinner og menn
    !is.na(Dots))


cor.test(sample.powerlifting$TotalKg, sample.powerlifting$BodyweightKg)

model <- lm(TotalKg ~ BodyweightKg, data = sample.powerlifting)
summary(model)

library(ggplot2)

ggplot(sample.powerlifting, aes(x = BodyweightKg, y = TotalKg)) +
  geom_point() +
  geom_smooth(method = "lm", color = "blue") +
  labs(title = "Forhold mellom kroppsvekt og total løftet vekt",
       x = "Kroppsvekt (kg)",
       y = "Total (kg)")





```

```{r}

# Calculate correlation between bodyweight and total lift
r <- cor(sample.powerlifting$BodyweightKg, sample.powerlifting$TotalKg)


# Calculate standard deviations of both variables
sd_y <- sd(sample.powerlifting$TotalKg)       # standard deviation of Total (Y)
sd_x <- sd(sample.powerlifting$BodyweightKg)  # standard deviation of Bodyweight (X)

# Compute the expected slope (b) from the correlation
b_expected <- r * (sd_y / sd_x)

# Display the expected regression coefficient
b_expected

mean_x <- mean(sample.powerlifting$BodyweightKg)
mean_y <- mean(sample.powerlifting$TotalKg)
b0_expected <- mean_y - b_expected * mean_x







```

## Sammenhengen mellom total, kjønn og alder

Det er godt etablert at både kjønn og alder har en effekt på maksimalstyrke. Menn løfter i gjennomsnitt med kvinner, og alder kan ha både en negativ og positiv innvirkning på maksimalstyrke.

Fra et fysiologisk standpunkt kan vi anta at det vil være et kurvilineært forhold mellom total, kjønn og alder, ettersom man vil bli sterkere opp til en viss alder, før man senere vil bli svakere igjen. Vi vil også forvente at menn og kvinner vil registrere ulike totaler på bakgrunn av ulik styrke.

Siden "openpowerlifting" datasettet inneholder over tre millioner rader, må vi filtrere dataene slik at de er mer håndterbare å lage modeller og grafer med. Vi valgte dermed å filtrere et utvalg på 5000 observasjoner.

Vi testet både en lineær og en polynomial regresjonsmodell. Det viste seg at den polynomiale modellen var mer passende, ettersom den lineære modellen viste en negativ korrelasjon mellom alder og total, som er fysiologisk svært usannsynlig (en 15-åring ville vært sterkere enn en 25 åring i gjennomsnitt med denne modellen). Ved bruk av den polynomiale modellen derimot, ser at vi styrken øker med økende alder til et visst punkt, før den igjen synker, og indikerer at det er et kurvilineært forhold.

```{r}
#Filtrerer datasettet slik at det er mer håndterbart og gjelder en mer homogen målgruppe

powerlifting.clean <- openpowerlifting |>
  filter(
    !is.na(TotalKg),  #Har en registrert total
    TotalKg > 0,
    Equipment == "Raw", #Utstyrsfritt
    !is.na(Tested), #Dopingtestet
    Sex %in% c("M", "F"),#Kun kvinner og menn
    !is.na(Dots)
    )

#Vi tar et tilfeldig utvalg "powerlifting.clean"

set.seed(123)
sample.powerlifting <- powerlifting.clean |>
  sample_n(5000)
```

Nå som vi har filtrert datasettet, kan vi lage en regresjonsmodell og en graf.

*Merk: Med denne regresjonsmodellen gjør vi en antagelse at alder har en lik effekt på maksimalstyrke uavhengig av kjønn*

```{r}
#| echo: false
#| message: false
#Polynomialregresjon

m <- lm(TotalKg ~ Sex + Age + I(Age^2), data = sample.powerlifting)

tidy(m) |>
  mutate(p.value = format.pval(p.value, digits = 2, eps = 0.001)) |>
  select(term, estimate, p.value) |>
  kable(digits = 3,
        col.names = c("Variabel", "Estimat", "p-verdi"))
```

### Tolkning av regresjonsmodellen

Vi ser fra modellen at skjæringspunktet er 124.5 kg, som betyr at gjennomsnittlig kvinne vil ha en total på 124.5 kg ved en alder av 0. Dette er det matematiske utgangspunktet til modellen, og i praksis ikke nyttig og unøyaktig siden datasettet ikke inneholder data på så unge utøvere. Vi ser også at menn i gjennomsnitt løfter 143.8kg mer enn kvinner, og at for hver økning i alder med antall år, vil vi få en økning på 9.6kg på totalen. Koeffisienten for Age\^2 (-0.15) viser at det er et ikke lineært forhold mellom alder og maksimalstyrke. Etter en viss alder, så vil styrken avta.

Alle koeffisientene har en p-verdi på \<0.001, som betyr at både kjønn og alder har en statistisk signifikant effekt på styrke. Modellen kan forklare omtrentlig 14% av variasjonen i total vekt løftet (Justert R-squared = 0.14), som tyder på at andre faktorer enn kjønn og alder spiller inn på maksimalstyrke.

### Figur 1: Kurvilineær graf av sammenhengen mellom total, kjønn og alder

*Figur 1: Figuren viser hvordan totalen varierer med alder for menn og kvinner, og når en topp rundt en alder av 30 -35 år, før den gradvis avtar.*

```{r}
#| echo: false
#| message: false
#| warning: false
ggplot(sample.powerlifting, aes(x = Age, y = TotalKg, color = Sex)) +
  geom_point(alpha = 0.2, size = 0.8) +
  geom_smooth(method = "lm", se = FALSE, formula = y ~ x + I(x^2)) +
  labs(
    title = "Polynomialregresjon",
    x = "Alder",
    y = "Total (Kg)"
  ) +
  theme_minimal()
```

## Hvordan kan vi tolke estimatet i en generalisert lineær modell hvor den avhengige variabelen er enten 1 eller 0? Hva betyr «link-function» i denne sammenhengen og hva gjør den?

En generalisert lineær modell (GLM) er en type modell som lar oss jobbe med data som ikke er normalfordelt. I vårt tilfelle, så kan vi bruke en GLM for å se på sannsynligheten for et binomialt utfall, som godkjent og ikke godkjent løft.

Vi tar utgangspunkt i om løfteren har fått det tredje løftet sitt i markløft godkjent. Suksess i tredje forsøket blir altså den avhengige variabelen. I openpowerlifting-datasettet, så har et godkjent løft en positiv verdi (eks: 120), og et ikke-godkjent løft en negative verdi (-120). Vi kan dermed definere den avhengige variabelen som 1 for godkjent løft hvis variabelen "Deadlift3Kg" \> 0, og som 0 for ikke-godkjent løft hvis "Deadlift3Kg" \< 0.

I modellen vår blir den uavhengie variabelen absolutt vekt forsøkt i markløft (Deadlift3attempt). Vi kan anta at med økende vekt, så vil sannsynligheten for å få et godkjent løft synke.

```{r}
powerlifting.clean2 <- 
  powerlifting.clean |>
  mutate(Deadlift3attempt_success = ifelse(Deadlift3Kg > 0, 1, 0)) |>
  filter(!is.na(Deadlift3attempt_success)) |>
  mutate(Deadlift3attempt = abs(Deadlift3Kg))

GLM_modell <- glm(Deadlift3attempt_success ~ Deadlift3attempt,
                  data = powerlifting.clean2,
                  family = binomial(link = "logit"))
```

Vi får da følgende estimater i modellen vår, med skjæringspunkt = 1,7 og et stigningstall = -0.006. Skjæringspunktet forteller oss log-goddsen for å få et godkjent løft når den uavhengige variabelen er 0, altså når man løfter 0 kg. Dette er i praksis absurd, og ikke nyttig. Men når vi ser på stigningstallet, så ser vi at det er negativt. Det betyr altså for hver økning av i kg, så vil log-oddsen reduseres med 0.006. På odds-skalaen vil det betyr at oddsen multipliseres med exp(-0.06) = 0.994, med andre ord en reduksjon på 0.6% per kg.

I modellen vår, så er "link-funksjonen" logit i koden. Den kobler den lineære delen av modellen til sannsynligheten for et binært utfall (godkjent / ikke-godkjent). Uten "link-funksjonen", ville vi fått verdier utenfor 0 og 1. Dette er spesielt viktig når vi skal se på sannsynligheter, siden verdiene vil alltid ligge mellom 0 og 1.

\
